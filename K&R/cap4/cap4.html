<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>第4章 函数与程序结构 | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.1.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../cap5/cap5.html" />
    
    
    <link rel="prev" href="../cap3/cap3.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="4" data-basepath=".." data-revision="1435825976787">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="cap1/cap1.html">
            
                
                    <a href="../cap1/cap1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         第1章 导言
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="cap2/cap2.html">
            
                
                    <a href="../cap2/cap2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         第2章 类型、运算符与表达式
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="cap3/cap3.html">
            
                
                    <a href="../cap3/cap3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         第3章 控制流
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="4" data-path="cap4/cap4.html">
            
                
                    <a href="../cap4/cap4.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         第4章 函数与程序结构
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="cap5/cap5.html">
            
                
                    <a href="../cap5/cap5.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         第5章 指针与数组
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="cap6/cap6.html">
            
                
                    <a href="../cap6/cap6.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         第6章 结构
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="cap7/cap7.html">
            
                
                    <a href="../cap7/cap7.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         第7章 输入与输出
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="8" data-path="cap8/cap8.html">
            
                
                    <a href="../cap8/cap8.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                         第8章 UNIX系统接口
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9" data-path="优先级.html">
            
                
                    <a href="../优先级.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                         运算符优先级总结
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10" data-path="cap2/char *s与char s[]的区别.html">
            
                
                    <a href="../cap2/char *s与char s[]的区别.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                         char *s与char s[]的区别
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_37">
                    
                        <p>ANSI标准进一步明确了名字的作用域规则，特别要求每个外部对象只能有一个定义。初始化的适用范围也更加广泛了，自动数组与结构都可以进行初始化。</p>
<p>C语言预处理器的功能也得到了增强。新的预处理器包含一组更完整的条件编译指令（一种通过宏参数创建带引号的字符串的方法），对宏扩展过程的控制更严格。</p>
<h2 id="41-">4.1 函数的基本知识</h2>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;stdio.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> MAXLINE 1000</span>

<span class="hljs-keyword">int</span> getline(<span class="hljs-keyword">char</span> line[], <span class="hljs-keyword">int</span> max);
<span class="hljs-keyword">int</span> strindex(<span class="hljs-keyword">char</span> sourcep[], <span class="hljs-keyword">char</span> searchfor[]);

<span class="hljs-keyword">char</span> pattern[] = <span class="hljs-string">"ould"</span>;

main()
{
    <span class="hljs-keyword">char</span> line[MAXLINE];
    <span class="hljs-keyword">int</span> found = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (getline(line, MAXLINE) &gt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> (strindex(line, pattern) &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, line);
            found++;
        }
    <span class="hljs-keyword">return</span> found;
}

<span class="hljs-comment">/* getline函数：将行保存到s中，并返回该行的长度 */</span>
<span class="hljs-keyword">int</span> getline(<span class="hljs-keyword">char</span> s[], <span class="hljs-keyword">int</span> lim)
{
    <span class="hljs-keyword">int</span> c, i;
    i = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (--lim &gt; <span class="hljs-number">0</span> &amp;&amp; (c=getchar()) != EOF &amp;&amp; c != <span class="hljs-string">'\n'</span>)
        s[i++] = c
    <span class="hljs-keyword">if</span> (c == <span class="hljs-string">'\n'</span>)
        s[i++] = c;
    s[i] = <span class="hljs-string">'\0'</span>;
    <span class="hljs-keyword">return</span> i;
}

<span class="hljs-comment">/* strindex函数：返回t在s中的位置，若未找到则返回-1 */</span>
<span class="hljs-keyword">int</span> strindex(<span class="hljs-keyword">char</span> s[], <span class="hljs-keyword">char</span> t[])
{
    <span class="hljs-keyword">int</span> i, j, k;

    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; s[i] != <span class="hljs-string">'\0'</span>; i++) {
        <span class="hljs-keyword">for</span> (j=<span class="hljs-number">0</span>, k=<span class="hljs-number">0</span>; t[k]!=<span class="hljs-string">'\0'</span> &amp;&amp; s[j]==t[k]; j++, k++)
        ;
        <span class="hljs-keyword">if</span> (k &gt; <span class="hljs-number">0</span> &amp;&amp; t[k] == <span class="hljs-string">'\0'</span>)
            <span class="hljs-keyword">return</span> i;
    }
    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}
</code></pre>
<p>最简单的函数</p>
<pre><code class="lang-c">dummy() {}
</code></pre>
<h2 id="42-">4.2 返回非整型值的函数</h2>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;ctype.h&gt;</span>

<span class="hljs-comment">/* atof函数：把字符串s转换为相应的双精读浮点数 */</span>
<span class="hljs-keyword">double</span> atof(<span class="hljs-keyword">char</span> s[])
{
    <span class="hljs-keyword">double</span> val, power;
    <span class="hljs-keyword">int</span> i, sign;

    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; <span class="hljs-built_in">isspace</span>(s[i]); i++)
        ;
    sign = (s[i] == <span class="hljs-string">'-'</span>) ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'+'</span> || s[i] == <span class="hljs-string">'-'</span>)
        i++;
    <span class="hljs-keyword">for</span> (val = <span class="hljs-number">0.0</span>; <span class="hljs-built_in">isdigit</span>(s[i]); i++)
        val = <span class="hljs-number">10.0</span> * val + (s[i] - <span class="hljs-string">'0'</span>);
    <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'.'</span>)
        i++;
    <span class="hljs-keyword">for</span> (power = <span class="hljs-number">1.0</span>; <span class="hljs-built_in">isdigit</span>(s[i]); i++) {
        val = <span class="hljs-number">10.0</span> * val + (s[i] - <span class="hljs-string">'0'</span>);
        power *= <span class="hljs-number">10.0</span>;
    }
    <span class="hljs-keyword">return</span> sign * val /power;
}

main()
{
    <span class="hljs-keyword">double</span> sum, atof(<span class="hljs-keyword">char</span> []);
    <span class="hljs-keyword">char</span> line[MAXLINE];
    <span class="hljs-keyword">int</span> getline(<span class="hljs-keyword">char</span> line[], <span class="hljs-keyword">int</span> max);

    sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (getline(line, MAXLINE) &gt; <span class="hljs-number">0</span>)
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\t%g\n"</span>, sum += atof(line));
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>如果先前没有声明过的一个名字出现在某个表达式中，并且其后紧跟一个左圆括号，那么上下文就会认为该名字是一个函数名字，该函数的返回值将被假定为int类型，但上下文并不对其参数作任何假设。</p>
<p>如果函数声明中不包括参数，例如：double atof();那么编译程序也不会对函数atof的参数作任何假设，并会关闭所有的参数检查。</p>
<p>提倡的做法，函数带有参数，则要声明它们；如果没有参数，则使用void进行声明。</p>
<pre><code class="lang-c"><span class="hljs-comment">/* atoi函数：利用atof函数把字符串s转换为整数 */</span>
<span class="hljs-keyword">int</span> atoi(<span class="hljs-keyword">char</span> s[])
{
    <span class="hljs-keyword">double</span> atof(<span class="hljs-keyword">char</span> s[]);

    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) atof(s);
}
</code></pre>
<h2 id="43-">4.3 外部变量</h2>
<p>外部变量与函数具有下列性质：通过同一个名字对外部变量的所有引用（即使这种引用来自与单独编译的不同函数）实际上都是引用同一个对象（标准中把这一性质称为外部链接）。</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;stdio.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;stdlib.h&gt;</span>

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> MAXOP 100</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> NUMBER '0'</span>

<span class="hljs-keyword">int</span> getop(<span class="hljs-keyword">char</span> []);
<span class="hljs-keyword">void</span> push(<span class="hljs-keyword">double</span>);
<span class="hljs-keyword">double</span> pop(<span class="hljs-keyword">void</span>);

<span class="hljs-comment">/* 逆波兰计算器 */</span>
main()
{
    <span class="hljs-keyword">int</span> type;
    <span class="hljs-keyword">double</span> op2;
    <span class="hljs-keyword">char</span> s[MAXOP];

    <span class="hljs-keyword">while</span> ((type = getop(s)) != EOF) {
        <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> NUMBER:
            push(atof(s));
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'+'</span>:
            push(pop() + pop());
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'*'</span>:
            push(pop() * pop());
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'-'</span>:
            op2 = pop();
            push(pop() - op2);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span>:
            op2 = pop();
            <span class="hljs-keyword">if</span> (op2 != <span class="hljs-number">0.0</span>)
                push(pop() /op2);
            <span class="hljs-keyword">else</span>
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: zero divisor\n"</span>);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'\n'</span>:
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\t%.8g\n"</span>, pop());
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: unknown command %s\n"</span>, s);
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> MAXVAL 100</span>
<span class="hljs-keyword">int</span> sp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> val[MAXVAL];

<span class="hljs-keyword">void</span> push(<span class="hljs-keyword">double</span> f)
{
    <span class="hljs-keyword">if</span> (sp &lt; MAXVAL)
        val[sp++] = f;
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: stack full, can't push %g\n"</span>, f);
}

<span class="hljs-keyword">double</span> pop(<span class="hljs-keyword">void</span>)
{
    <span class="hljs-keyword">if</span> (sp &gt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">return</span> val[--sp];
    <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: stack empty\n"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
    }
}

<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;ctype.h&gt;</span>

<span class="hljs-keyword">int</span> getch(<span class="hljs-keyword">void</span>);
<span class="hljs-keyword">void</span> ungetch(<span class="hljs-keyword">int</span>);

<span class="hljs-comment">/* getop函数： 获取下一个运算符或数值操作数 */</span>
<span class="hljs-keyword">int</span> getop(<span class="hljs-keyword">char</span> s[])
{
    <span class="hljs-keyword">int</span> i, c;

    <span class="hljs-keyword">while</span> ((s[<span class="hljs-number">0</span>] = c = getch()) == <span class="hljs-string">' '</span> || c == <span class="hljs-string">'\t'</span>)
        ;
    s[<span class="hljs-number">1</span>] = <span class="hljs-string">'\0'</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isdigit</span>(c) &amp;&amp; c != <span class="hljs-string">'.'</span>)
        <span class="hljs-keyword">return</span> c;
    i = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isdigit</span>(c))
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(s[++i] = c = getch()))
            ;
    <span class="hljs-keyword">if</span> (c == <span class="hljs-string">'.'</span>)
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(s[++i] = c = getch()))
            ;
    s[i] = <span class="hljs-string">'\0'</span>;
    <span class="hljs-keyword">if</span> (c != EOF)
        ungetch(c);
    <span class="hljs-keyword">return</span> NUMBER;
}

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> BUFSIZE 100</span>

<span class="hljs-keyword">char</span> buf[BUFSIZE];
<span class="hljs-keyword">int</span> bufp = <span class="hljs-number">0</span>;

<span class="hljs-keyword">int</span> getch(<span class="hljs-keyword">void</span>)
{
    <span class="hljs-keyword">return</span> (bufp &gt; <span class="hljs-number">0</span>) ? buf[--bufp] : getchar();
}

<span class="hljs-keyword">void</span> ungetch(<span class="hljs-keyword">int</span> c)
{
    <span class="hljs-keyword">if</span> (bufp &gt;= BUFSIZE)
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ungetch: too many characters\n"</span>);
    <span class="hljs-keyword">else</span>
        buf[bufp++] = c;
}
</code></pre>
<h2 id="44-">4.4 作用域规则</h2>
<p>外部变量或函数的作用域从<strong>声明</strong>它的地方开始，到其所在的（待编译的）文件的末尾结束。</p>
<p>要在外部变量的定义之前使用该变量，或者变量的定义与变量的使用不再同一个源文件中，则必须在相应的变量声明中强制性地使用关键字<code>extern</code>.</p>
<p>将外部变量的声明和定义严格区分开来很重要。变量声明用于说明变量的属性（主要是变量的类型），而变量定义除此以外还将引起存储器的分配。</p>
<pre><code class="lang-c"><span class="hljs-comment">// 定义外部变量，并为之分配存储单元</span>
<span class="hljs-keyword">int</span> sp;
<span class="hljs-keyword">double</span> val[<span class="hljs-number">100</span>];

<span class="hljs-comment">// 声明外部变量</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> sp;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">double</span> val[];
</code></pre>
<p>在一个源程序的所有源文件中，一个外部变量只能在某个文件中定义一次，而其他文件可以通过extern声明来访问它。外部变量的定义中必须指定数组的长度，但extern声明则不一定要指定数组的长度。</p>
<p>外部变量的初始化只能出现在其定义中。</p>
<pre><code class="lang-c"><span class="hljs-comment">// file1</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> sp;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">double</span> val[];

<span class="hljs-comment">// file2</span>
<span class="hljs-keyword">int</span> sp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> val[<span class="hljs-number">100</span>];
</code></pre>
<h2 id="45-">4.5 头文件</h2>
<p>考虑定义和声明在这些文件之间的共享问题。我们尽可能把共享的部分集中在一起，这样就只需要一个副本，改进程序时也很容易保证程序的正确性。我们把这些公共部分放在头文件calc.h中。</p>
<h2 id="46-">4.6 静态变量</h2>
<p>用static声明限定外部变量与函数，可以将其后声明的对象的作用域限定为被编译源文件的剩余部分。通过static限定外部对象，可以达到隐藏外部对象的目的。</p>
<p>static用于声明内部变量时。static类型的内部变量是一种只能在某个特定函数中使用但一直占据存储空间的变量。</p>
<h2 id="47-">4.7 寄存器变量</h2>
<p>register声明高速编译器，此变量在程序中使用频率较高。放在寄存器中访问最快。</p>
<p>register声明只适用于自动变量以及函数的形式参数。</p>
<pre><code class="lang-c">f(<span class="hljs-keyword">register</span> <span class="hljs-keyword">unsigned</span> m)
{
    <span class="hljs-keyword">register</span> <span class="hljs-keyword">int</span> i;
}
</code></pre>
<p>过量的寄存器声明并没有害处，编译器可以忽略过量的或不支持的寄存器变量声明。寄存器变量的地址是不能访问的。</p>
<h2 id="48-">4.8 程序块结构</h2>
<p>变量声明（包括初始化）除了可以紧跟在函数开始的花括号之后，还可以紧跟在任何其他标识复合语句开始的花括号之后。以这种方式声明的变量可以隐藏程序块与之同名的变量，它们之间没有任何关系。</p>
<pre><code class="lang-c"><span class="hljs-keyword">int</span> (n &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; n; i++)
        ...
}
</code></pre>
<p>变量i的作用域是if语句的“真”分支，与程序块外声明的i无关。</p>
<h2 id="49-">4.9 初始化</h2>
<p>在不进行显式初始化的情况下，外部变量和静态变量都将被初始化为0，自动变量和寄存器变量的初值没有定义。</p>
<p>外部变量与静态变量，初始化表达式必须是常量表达式</p>
<p>如果初始化表达式的个数比数组元素数少，则对外部变量、静态变量和自动变量来说，没有初始化表达式的元素将被初始化为0。</p>
<pre><code class="lang-c"><span class="hljs-keyword">char</span> pattern[] = <span class="hljs-string">"ould"</span>;
<span class="hljs-keyword">char</span> pattern[] = {<span class="hljs-string">'o'</span>,<span class="hljs-string">'u'</span>,<span class="hljs-string">'l'</span>,<span class="hljs-string">'d'</span>,<span class="hljs-string">'\0'</span>};
</code></pre>
<h2 id="410-">4.10 递归</h2>
<h2 id="411-c">4.11 C预处理器</h2>
<h3 id="4111-">4.11.1 文件包含</h3>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> "文件名"</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;文件名&gt;</span>
的区别
</code></pre>
<h1 id="includedefineexternstdioh">include指令，它们用以包含常见的#define语句和extern声明，或从头文件中访问库函数的函数原型声明，如<stdio.h>。</h1>
<h3 id="4112-">4.11.2 宏替换</h3>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> 名字 替换文本</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> max(A, B) ((A) &gt; (B) ? (A) : (B))</span>
</code></pre>
<p>作用域从其定义点开始，到被编译的源文件的末尾处结束。</p>
<p>参数表达式存在副作用（如自增运算符），会出现不正确的情况。</p>
<p>使用圆括号以保证计算次序的正确性。</p>
<pre><code class="lang-c"><span class="hljs-comment">// 取消名字的宏定义</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">undef</span> getchar </span>

<span class="hljs-comment">// 以#作为前缀的参数会被参数名字符串所替代</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> dprint(expr) printf(#expr " = %g\n", expr)</span>
dprint(x/y) ==&gt; <span class="hljs-built_in">printf</span>(<span class="hljs-string">"x/y"</span> <span class="hljs-string">" = %g\n"</span>, x/y);

<span class="hljs-comment">// ##为宏扩展提供了一种连接实际参数的手段</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> paste(front, back) front ## back</span>
paste(name,<span class="hljs-number">1</span>) ==&gt; name1
</code></pre>
<h3 id="4113-">4.11.3 条件包含</h3>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> !defined(HDR)</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> HDR</span>
...
<span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-preprocessor">#ifndef HDR</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> HDR</span>
...
<span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-comment">//例</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> SYSTEM == SYSV</span>
    <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> HDR "sysv.h"</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">elif</span> SYSTEM == BSD</span>
    <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> HDR "bsd.h"</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">elif</span> SYSTEM == MSDOS</span>
    <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> HDR "msdos.h"</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> HDR "default.h"</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>
<span class="hljs-preprocessor">#include HDR</span>
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../cap3/cap3.html" class="navigation navigation-prev " aria-label="Previous page: 第3章 控制流"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../cap5/cap5.html" class="navigation navigation-next " aria-label="Next page: 第5章 指针与数组"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
